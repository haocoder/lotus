# å›¾ç‰‡å‹ç¼©åŠŸèƒ½é›†æˆæ€»ç»“

## ğŸ¯ é›†æˆç›®æ ‡

å°†å›¾ç‰‡å‹ç¼©åŠŸèƒ½æ— ç¼é›†æˆåˆ°ç°æœ‰çš„`sem_filter`ç®—å­ä¸­ï¼Œæä¾›æ™ºèƒ½çš„å›¾ç‰‡å¤„ç†ä¼˜åŒ–ï¼ŒåŒæ—¶ä¿æŒå‘åå…¼å®¹æ€§ã€‚

## ğŸ“Š é›†æˆç»“æœ

### âœ… é›†æˆå®ŒæˆçŠ¶æ€

**æ‰€æœ‰å…³é”®ç»„ä»¶å·²æˆåŠŸé›†æˆï¼š**

1. **sem_filterå‚æ•°æ‰©å±•** âœ…
   - `enable_image_compression`: æ˜¯å¦å¯ç”¨å›¾ç‰‡å‹ç¼©
   - `image_compression_strategy`: å‹ç¼©ç­–ç•¥ ("simple" or "advanced")
   - `image_max_size`: æœ€å¤§å›¾ç‰‡å°ºå¯¸
   - `image_quality`: å‹ç¼©è´¨é‡ (1-100)
   - `image_format`: è¾“å‡ºæ ¼å¼ ("JPEG", "PNG", "WEBP")

2. **é…ç½®ç®¡ç†å™¨** âœ…
   - `ImageCompressionConfig`: å›¾ç‰‡å‹ç¼©é…ç½®ç±»
   - `get_global_config()`: è·å–å…¨å±€é…ç½®
   - `set_global_config()`: è®¾ç½®å…¨å±€é…ç½®
   - `create_config_from_sem_filter_params()`: ä»sem_filterå‚æ•°åˆ›å»ºé…ç½®

3. **å›¾ç‰‡ä¼˜åŒ–å™¨** âœ…
   - `ImageOptimizer`: æ™ºèƒ½å›¾ç‰‡ä¼˜åŒ–å™¨
   - `_compress_image_simple()`: ç®€å•å‹ç¼©æ–¹æ³•
   - `_compress_image_advanced()`: é«˜çº§å‹ç¼©æ–¹æ³•
   - `_choose_compression_method()`: å‹ç¼©æ–¹æ³•é€‰æ‹©

4. **fetch_imageé›†æˆ** âœ…
   - è‡ªåŠ¨ä½¿ç”¨å…¨å±€é…ç½®
   - æ™ºèƒ½URLæ£€æµ‹
   - é”™è¯¯å›é€€æœºåˆ¶

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. **å‚æ•°ä¼ é€’é“¾**

```
sem_filter() 
    â†“ å›¾ç‰‡å‹ç¼©å‚æ•°
_sem_filter_batch() / _sem_filter_individual() / sem_filter_async()
    â†“ è®¾ç½®å…¨å±€é…ç½®
set_global_config()
    â†“ é…ç½®ç”Ÿæ•ˆ
fetch_image() â†’ get_global_config() â†’ optimize_image()
```

### 2. **é…ç½®ç®¡ç†æ¶æ„**

```python
# å…¨å±€é…ç½®ç®¡ç†
_global_config = ImageCompressionConfig()

# sem_filterä¸­è®¾ç½®é…ç½®
set_global_config(
    enable_compression=enable_image_compression,
    strategy=image_compression_strategy,
    max_size=image_max_size,
    quality=image_quality,
    format=image_format
)

# fetch_imageä¸­ä½¿ç”¨é…ç½®
config = get_global_config()
return config.optimize_image(image)
```

### 3. **å‹ç¼©ç­–ç•¥é€‰æ‹©**

```python
# ç®€å•å‹ç¼©ï¼šå¿«é€Ÿå¤„ç†
optimizer = ImageOptimizer(use_advanced_compression=False)

# é«˜çº§å‹ç¼©ï¼šæ™ºèƒ½ä¼˜åŒ–
optimizer = ImageOptimizer(use_advanced_compression=True)
```

## ğŸ“ æ–‡ä»¶ç»“æ„

### æ–°å¢æ–‡ä»¶
- `lotus/utils/image_compression_config.py` - é…ç½®ç®¡ç†å™¨
- `lotus/utils/image_optimizer.py` - å›¾ç‰‡ä¼˜åŒ–å™¨ï¼ˆå·²æ›´æ–°ï¼‰

### ä¿®æ”¹æ–‡ä»¶
- `lotus/sem_ops/sem_filter.py` - æ·»åŠ å›¾ç‰‡å‹ç¼©å‚æ•°
- `lotus/utils.py` - é›†æˆé…ç½®ç®¡ç†å™¨

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºæœ¬ä½¿ç”¨
```python
import lotus
from lotus.models import LM

# é…ç½®æ¨¡å‹
lotus.settings.configure(lm=LM(model="gpt-4o"))

# ä½¿ç”¨é»˜è®¤å›¾ç‰‡å‹ç¼©è®¾ç½®
docs = [{"text": "æè¿°", "image": "path/to/image.jpg"}]
result = sem_filter(docs, model, "åˆ†æå›¾ç‰‡å†…å®¹")
```

### è‡ªå®šä¹‰å‹ç¼©è®¾ç½®
```python
# ä½¿ç”¨é«˜çº§å‹ç¼©ç­–ç•¥
result = sem_filter(
    docs, model, "åˆ†æå›¾ç‰‡å†…å®¹",
    enable_image_compression=True,
    image_compression_strategy="advanced",
    image_max_size=(1024, 1024),
    image_quality=85,
    image_format="JPEG"
)

# ä½¿ç”¨ç®€å•å‹ç¼©ç­–ç•¥
result = sem_filter(
    docs, model, "åˆ†æå›¾ç‰‡å†…å®¹",
    image_compression_strategy="simple",
    image_max_size=(512, 512),
    image_quality=70
)

# ç¦ç”¨å›¾ç‰‡å‹ç¼©
result = sem_filter(
    docs, model, "åˆ†æå›¾ç‰‡å†…å®¹",
    enable_image_compression=False
)
```

### å…¨å±€é…ç½®
```python
from lotus.utils.image_compression_config import set_global_config

# è®¾ç½®å…¨å±€é…ç½®
set_global_config(
    enable_compression=True,
    strategy="advanced",
    max_size=(1024, 1024),
    quality=85,
    format="JPEG"
)
```

## ğŸ›ï¸ é…ç½®å‚æ•°è¯¦è§£

### å‹ç¼©ç­–ç•¥å¯¹æ¯”

| ç­–ç•¥ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | æ€§èƒ½ |
|------|------|----------|------|
| `simple` | å¿«é€Ÿå•æ¬¡å‹ç¼© | å¯¹è´¨é‡è¦æ±‚ä¸é«˜ | å¿« |
| `advanced` | æ™ºèƒ½æ¸è¿›å¼å‹ç¼© | å¯¹å‹ç¼©ç‡è¦æ±‚é«˜ | è¾ƒæ…¢ä½†æ•ˆæœå¥½ |

### å›¾ç‰‡æ ¼å¼é€‰æ‹©

| æ ¼å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `JPEG` | æœ‰æŸå‹ç¼©ï¼Œæ–‡ä»¶å° | ç…§ç‰‡ã€å¤æ‚å›¾ç‰‡ |
| `PNG` | æ— æŸå‹ç¼©ï¼Œæ”¯æŒé€æ˜ | å›¾æ ‡ã€ç®€å•å›¾ç‰‡ |
| `WEBP` | ç°ä»£æ ¼å¼ï¼Œå‹ç¼©ç‡é«˜ | ç°ä»£æµè§ˆå™¨æ”¯æŒ |

### è´¨é‡å‚æ•°å»ºè®®

| è´¨é‡ | æ–‡ä»¶å¤§å° | è§†è§‰è´¨é‡ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|----------|
| 90-100 | å¤§ | æé«˜ | ä¸“ä¸šç”¨é€” |
| 80-89 | è¾ƒå¤§ | é«˜ | é«˜è´¨é‡éœ€æ±‚ |
| 70-79 | ä¸­ç­‰ | è‰¯å¥½ | å¹³è¡¡é€‰æ‹© |
| 50-69 | è¾ƒå° | å¯æ¥å— | å¿«é€Ÿå¤„ç† |
| 30-49 | å° | è¾ƒä½ | æé€Ÿå¤„ç† |

## ğŸ”„ å‘åå…¼å®¹æ€§

### å®Œå…¨å…¼å®¹
- âœ… ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
- âœ… é»˜è®¤å‚æ•°ä¿æŒåŸæœ‰è¡Œä¸º
- âœ… æ–°å‚æ•°ä¸ºå¯é€‰å‚æ•°
- âœ… é”™è¯¯æ—¶è‡ªåŠ¨å›é€€

### æ¸è¿›å¼å¢å¼º
- âœ… å¯é€‰æ‹©æ€§å¯ç”¨å›¾ç‰‡å‹ç¼©
- âœ… å¯é…ç½®å‹ç¼©ç­–ç•¥
- âœ… å¯è°ƒæ•´å‹ç¼©å‚æ•°
- âœ… å¯ç¦ç”¨å‹ç¼©åŠŸèƒ½

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–æ•ˆæœ

### 1. **URLå›¾ç‰‡å¤„ç†**
```
ä¼˜åŒ–å‰ï¼šä¸‹è½½ â†’ å¤„ç† â†’ ç¼–ç  â†’ ä¼ è¾“
ä¼˜åŒ–åï¼šç›´æ¥ä¼ é€’URL
æ€§èƒ½æå‡ï¼š100%ï¼ˆé›¶å¤„ç†æ—¶é—´ï¼‰
```

### 2. **æœ¬åœ°å›¾ç‰‡å¤„ç†**
```
ä¼˜åŒ–å‰ï¼šåŠ è½½ â†’ å¤„ç† â†’ ç¼–ç 
ä¼˜åŒ–åï¼šæ™ºèƒ½å‹ç¼© â†’ ä¼˜åŒ–ç¼–ç 
æ€§èƒ½æå‡ï¼š50-80%ï¼ˆå‡å°‘ä¼ è¾“æ•°æ®é‡ï¼‰
```

### 3. **ç¼“å­˜æœºåˆ¶**
```
ä¼˜åŒ–å‰ï¼šæ¯æ¬¡éƒ½é‡æ–°å¤„ç†
ä¼˜åŒ–åï¼šç¼“å­˜å‘½ä¸­æ—¶ç›´æ¥è¿”å›
æ€§èƒ½æå‡ï¼š90%+ï¼ˆç¼“å­˜å‘½ä¸­æ—¶ï¼‰
```

## ğŸ› ï¸ æŠ€æœ¯äº®ç‚¹

### 1. **æ™ºèƒ½ç±»å‹è¯†åˆ«**
- URLå›¾ç‰‡ï¼šé›¶å¼€é”€ç›´æ¥ä¼ é€’
- æœ¬åœ°å›¾ç‰‡ï¼šæ™ºèƒ½å‹ç¼©ä¼˜åŒ–
- å·²ç¼–ç å›¾ç‰‡ï¼šæ™ºèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°å‹ç¼©

### 2. **æ¸è¿›å¼å‹ç¼©**
- 4çº§å‹ç¼©ç­–ç•¥ï¼šæ ‡å‡†â†’ä¸­ç­‰â†’é«˜â†’æé«˜
- è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç»“æœ
- æ™ºèƒ½åœæ­¢æ¡ä»¶ï¼ˆ<200KBï¼‰

### 3. **é…ç½®ç®¡ç†**
- å…¨å±€é…ç½®ç®¡ç†
- ç®—å­çº§åˆ«é…ç½®è¦†ç›–
- è¿è¡Œæ—¶é…ç½®æ›´æ–°

### 4. **é”™è¯¯å¤„ç†**
- ä¼˜é›…é™çº§æœºåˆ¶
- è‡ªåŠ¨å›é€€åˆ°åŸå§‹é€»è¾‘
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

## ğŸ‰ æ€»ç»“

å›¾ç‰‡å‹ç¼©åŠŸèƒ½å·²æˆåŠŸé›†æˆåˆ°`sem_filter`ç®—å­ä¸­ï¼Œæä¾›äº†ï¼š

1. **å®Œæ•´çš„å‚æ•°æ”¯æŒ**ï¼š5ä¸ªå›¾ç‰‡å‹ç¼©ç›¸å…³å‚æ•°
2. **æ™ºèƒ½çš„å‹ç¼©ç­–ç•¥**ï¼šç®€å•å’Œé«˜çº§ä¸¤ç§ç­–ç•¥
3. **çµæ´»çš„é…ç½®ç®¡ç†**ï¼šå…¨å±€å’Œç®—å­çº§åˆ«é…ç½®
4. **ä¼˜ç§€çš„æ€§èƒ½**ï¼šURLé›¶å¼€é”€ï¼Œæœ¬åœ°å›¾ç‰‡æ™ºèƒ½å‹ç¼©
5. **å®Œå…¨çš„å…¼å®¹æ€§**ï¼šå‘åå…¼å®¹ï¼Œæ¸è¿›å¼å¢å¼º

è¯¥é›†æˆæ–¹æ¡ˆä¸ºLotusæ¡†æ¶çš„å¤šæ¨¡æ€æ•°æ®å¤„ç†æä¾›äº†å¼ºå¤§çš„å›¾ç‰‡ä¼˜åŒ–èƒ½åŠ›ï¼Œæ˜¾è‘—æå‡äº†`sem_filter`ç®—å­åœ¨å¤„ç†åŒ…å«å›¾ç‰‡çš„æ–‡æ¡£æ—¶çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚
